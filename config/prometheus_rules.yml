groups:
  - {name: simulator-alert-rule, rules: [{alert: HttpSimulatorDown, expr: 'sum(up{job="linux"}) == 0', for: 1m, labels: {severity: page}, annotations: {summary: 'Instance {{ $labels.instance }} down', description: '{{ $labels.instance }} of job {{ $labels.job }} has been down for more than 1 minutes.'}}]}
  - {name: mysql_not_up, rules: [{alert: mysql_not_up, expr: 'up{job=~"mysql_.*"} == 0', for: 10s, labels: {severity: critical}}]}
  - {name: node_not_up, rules: [{alert: node_not_up, expr: 'up{job=~"linux_.*"} == 0', for: 1m, labels: {severity: page}, annotations: {summary: 'Instance {{ $labels.instance }} down', description: '{{ $labels.instance }} of job {{ $labels.job }} has been down for more than 1 minutes.'}}]}
  - {name: 'Use More Than 0.98 of max connections limited', rules: [{alert: 'Used more than 0.98', expr: mysql_global_status_max_used_connections/mysql_global_variables_max_connections>0.98, for: 10s, labels: {severity: page}, annotations: {summary: 'Instance {{ $labels.instance }} over connected', description: '{{ $labels.instance }} of job {{ $labels.job }}:Used more than 98% of max connections limited'}}]}
  - {name: 'Memory Too High', rules: [{alert: 'Resrouce Occupied Too High', expr: 'avg((100-irate(node_cpu_seconds_total{mode="idle"}[10s])*100))by(job) >70 and avg((100   - 100 * (node_memory_MemFree_bytes + node_memory_Cached_bytes + node_memory_Buffers_bytes   + node_memory_Slab_bytes) / node_memory_MemTotal_bytes))by(job) > 70', for: 2m, labels: {severity: page}, annotations: {summary: 'instance {{ $labels.instance }} over used', description: 'instance {{ $labels.instance }}  CPU more than 70% and Memory more than 70%'}}]}
  - {name: 'QPS Too High', rules: [{alert: 'QPS Too High', expr: 'rate(mysql_global_status_questions[1m]) > 10000', for: 1m, labels: {severity: page}, annotations: {summary: 'instance {{ $labels.instance }} QPS Too High', description: 'instance {{ $labels.instance }} of job {{ $labels.job }}:Used more than 10000 QPS'}}]}
  - {name: 'TPS Too High', rules: [{alert: 'TPS Too High', expr: 'sum(rate(mysql_global_status_commands_total{command=~"commit|rollback"}[10s]))by(job) > 4000', for: 1m, labels: {severity: page}, annotations: {summary: 'instance {{ $labels.instance }} TPS Too High', description: 'instance {{ $labels.instance }} of job {{ $labels.job }}:Used more than 10000 TPS'}}]}
  - {name: 'open files high', rules: [{alert: 'open files high', expr: 'mysql_global_status_innodb_num_open_files / mysql_global_variables_open_files_limit > 0.75', for: 5m, labels: {severity: page}, annotations: {summary: 'instance {{ $labels.instance }}open files high', description: 'instance {{ $labels.instance }} of job {{ $labels.job }}: Open files is high. Please consider increasing open_files_limit.'}}]}
  - {name: 'InnoDB Buffer命中率过低', rules: [{alert: 'InnoDB Buffer命中率过低', expr: '(100-100*(rate(mysql_global_status_innodb_buffer_pool_reads[60s]))/(rate(mysql_global_status_innodb_buffer_pool_read_requests[60s]))) < 95', for: 5m, labels: {severity: page}, annotations: {summary: 'instance {{ $labels.instance }} InnoDB Buffer命中率过低', description: 'instance {{ $labels.instance }} of job {{ $labels.job }}: 通常InnoDB存储引擎缓冲池的命中不应该小于99%,该数据库命中率低于95%'}}]}
  - {name: 'Read buffer size is bigger than max allowed packet size', rules: [{alert: 'Read buffer size is bigger than max allowed packet size', expr: 'mysql_global_variables_read_buffer_size / mysql_global_variables_slave_max_allowed_packet >1', for: 20s, labels: {severity: page}, annotations: {summary: 'instance {{ $labels.instance }} Read buffer size is bigger than max allowed packet size', description: 'instance {{ $labels.instance }} of job {{ $labels.job }}: 读取缓冲区大小（read_buffer_size）大于允许的最大数据包大小（max_allowed_packet）。这可能会中断复制'}}]}
  - {name: 'Sort buffer possibly missconfigured', rules: [{alert: 'Sort buffer possibly missconfigured', expr: 'mysql_global_variables_innodb_sort_buffer_size <256*1024 or mysql_global_variables_innodb_sort_buffer_size > 4*1024*1024', for: 0s, labels: {severity: page}, annotations: {summary: 'instance {{ $labels.instance }} Sort buffer possibly missconfigured', description: 'instance {{ $labels.instance }} of job {{ $labels.job }}: Sort buffer size is either too big or too small. A good value for sort_buffer_size is between 256k and 4M. 排序缓冲区大小太大或太小。sort_buffer_size的合适值在256k和4M之间。'}}]}
  - {name: 'Thread stack size is too small', rules: [{alert: 'Thread stack size is too small', expr: 'mysql_global_variables_thread_stack <196608', for: 0s, labels: {severity: page}, annotations: {summary: 'instance {{ $labels.instance }} Thread stack size is too small', description: 'instance {{ $labels.instance }} of job {{ $labels.job }}: Thread stack size is too small. This can cause problems when you use Stored Language constructs for example. A typical is 256k for thread_stack_size. 线程堆栈大小太小。在使用存储语言构造时，这可能会导致问题。thread_stack_size的典型值为256k。'}}]}
  - {name: 'InnoDB Flush Log at Transaction Commit', rules: [{alert: 'InnoDB Flush Log at Transaction Commit', expr: 'mysql_global_variables_innodb_flush_log_at_trx_commit != 1', for: 0s, labels: {severity: page}, annotations: {summary: 'instance {{ $labels.instance }} InnoDB Flush Log at Transaction Commit', description: 'instance {{ $labels.instance }} of job {{ $labels.job }}: InnoDB Flush Log at Transaction Commit is set to a values != 1. This can lead to a loss of commited transactions in case of a power failure. 事务提交时的InnoDB刷新日志设置为值=1。这可能导致断电时丢失已提交的事务。'}}]}
